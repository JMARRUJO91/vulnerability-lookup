{% from 'bootstrap5/utils.html' import render_icon %}
{% macro collapse_raw(source, vulnerability_id, vulnerability_data) %}
<br /><br />
<div class="btn-group" role="group">
  <a role="button" class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#collapseJson{{vulnerability_id}}" aria-expanded="false" aria-controls="collapseJson{{vulnerability_id}}">
    JSON {{ render_icon('chevron-down') }}
  </a>
  <div class="btn-group" role="group">
    <button id="btnGroupDropShare" type="button" class="btn btn-primary" data-bs-toggle="dropdown" aria-expanded="false">
      Share {{ render_icon('chevron-down') }}
    </button>
    <ul class="dropdown-menu" aria-labelledby="btnGroupDropShare">
      <li><a class="dropdown-item" href="https://news.ycombinator.com/submitlink?u=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&t=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Hacker News">Hacker News</a></li>
      <li><a class="dropdown-item" href="https://www.linkedin.com/shareArticle?mini=true&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on LinkedIn">LinkedIn</a></li>
      <li><a class="dropdown-item" href="https://mastodonshare.com/?text=Vulnerability {{ vulnerability_id }}&url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}" target="_blank" title="Share on Mastodon">Mastodon</a></li>
      <li><a class="dropdown-item" href="https://www.newspipe.org/bookmark/bookmarklet?href=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Newspipe">Newspipe</a></li>
      <li><a class="dropdown-item" href="https://api.pinboard.in/v1/posts/add?url=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&description=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Pinboard">Pinboard</a></li>
      <li><a class="dropdown-item" href="https://reddit.com/submit?link=https://{{ config.PUBLIC_DOMAIN }}{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}&title=Vulnerability {{ vulnerability_id }}" target="_blank" title="Share on Reddit">Reddit</a></li>
    </ul>
  </div>
  <a type="button" class="btn btn-primary" title="Copy to clipboard" aria-label="Copy to clipboard" onclick="copyToClipboard('{{vulnerability_id}}')" vuln-id="{{vulnerability_id}}" href="#">To clipboard</a>
  {% if  config.user_accounts and current_user.is_authenticated and source in ["cvelistv5", local_instance_name]  %}
  <a role="button" class="btn btn-primary" title="Edit the object" aria-label="Edit the vulnerability" href="{{ url_for('user_bp.vulnogram', vulnerability_id=vulnerability_id) }}">Edit</a>
  {% endif %}
  {% if config.user_accounts and current_user.is_authenticated and source == local_instance_name  %}
  <a role="button" class="btn btn-danger" id="deleteVulnerability" type="button" href="#">Delete</a>
  {% endif %}
</div>

<div class="collapse" id="collapseJson{{vulnerability_id}}">
  <br />
  <div class="card card-body">
    <pre class="json-container" id="container{{vulnerability_id}}">{{vulnerability_data|tojson(indent=2)}}</pre>
  </div>
</div>
{%- endmacro %}

{% macro cisa_known_exploited_view(data) -%}
<div class="card">
  <div class="card-body">
    <h5 class="card-title">CISA Known exploited vulnerability</h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Data from the <a href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog" rel="noreferrer" target="_blank">Known Exploited Vulnerabilities Catalog</a>
    </h6>
    <p class="card-text">Date added: {{data['dateAdded']}}</p>
    <p class="card-text">Due date: {{data['dueDate']}}</p>
    <p class="card-text">Required action: {{data['requiredAction']}}</p>
    <p class="card-text">Used in ransomware: {{data['knownRansomwareCampaignUse']}}</p>
    {%if data['notes'] %}
    <p class="card-text">Notes: {{data['notes']}}</p>
    {%endif%}
  </div>
</div>
{%- endmacro %}

{% macro nvd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://nvd.nist.gov/vuln" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{vulnerability_data['cve']['descriptions'][0]['value']}}</p>
    {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
    {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
    {%endif%}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro cvelistv5_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/CVEProject/cvelistV5" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {% endfor %}
      {% endif %}
    {% else %}
      <div class="row">
          <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['cveMetadata']['datePublished'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
      </div>
      <div class="row">
          <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['cveMetadata']['dateUpdated'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
      </div>
      {% if vulnerability_data['containers']['cna']['metrics'] %}
      {% set severity_css = {"Low": "bg-success", "Medium": "bg-warning", "High": "bg-danger", "Critical": "bg-danger"} %}
      <div class="row">
        <div class="col-md-2 fw-bold">Severity</div>
        <div class="col">
          {% for metric in vulnerability_data['containers']['cna']['metrics'] %}
          {% if 'cvssV3_1' in metric or 'cvssV3_0' in metric  %}
            {% if 'vectorString' in metric['cvssV3_1'] %}
              {% set vectorString = metric['cvssV3_1']['vectorString'] %}
              {% set version = 'cvssV3_1' %}
              {% set version_short = '3.1' %}
            {% endif %}
            {% if 'vectorString' in metric['cvssV3_0'] %}
              {% set vectorString = metric['cvssV3_0']['vectorString'] %}
              {% set version = 'cvssV3_0' %}
              {% set version_short = '3.0' %}
            {% endif %}
              <span class="{{ severity_css[vectorString | cvss_severity(version)] }}">{{ vectorString | cvss_base_score(version) }} ({{ vectorString | cvss_severity(version) }})</span> - {{ version }} - <a href="https://www.first.org/cvss/calculator/{{ version_short }}#{{ vectorString | cvss_clean_vector(version) }}" rel="noreferrer" target="_blank">{{ vectorString | cvss_clean_vector(version) }}</a><br />
          {% endif %}
          {% endfor %}
        </div>
      </div>
      {% endif %}
      {% if vulnerability_data['containers']['cna']['title'] %}
        <div class="row">
          <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['containers']['cna']['title']}}</div>
        </div>
      {% else %}
        <div class="row">
          <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</div>
        </div>
      {% endif %}
      <table class="table table-borderless table-hover caption-top">
        <caption class="col-md-2 fw-bold">Impacted product(s).</caption>
        <tr><th>Vendor</th><th>Product</th></tr>
        {% for elem in vulnerability_data['containers']['cna']['affected'] %}
          <tr><td><a href="{{ url_for('home_bp.search', vendor=elem['vendor']) }}">{{ elem['vendor'] }}</a></td><td><a href="{{ url_for('home_bp.search', vendor=elem['vendor'], product=elem['product']) }}">{{ elem['product'] }}</a></td></tr>
        {% endfor %}
      </table>
      {% if 'cisa_known_exploited' in vulnerability_data['meta'] %}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {% endif %}
    {% endif %}
    <a href="https://nvd.nist.gov/vuln/detail/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on NVD website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro circl_view(source, vulnerability_id, vulnerability_data, current_user) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from {{source}}
    </h6>
    {%if 'rejectedReasons' in vulnerability_data['containers']['cna']%}
      {%for reason in vulnerability_data['containers']['cna']['rejectedReasons']%}
        <p class="card-text">{{reason['value']}}</p>
      {%endfor%}
      {% if 'replacedBy' in vulnerability_data['containers']['cna']%}
        {% for replaced in  vulnerability_data['containers']['cna']['replacedBy'] %}
        <p class="card-text">
          Replaced by <a href="{{url_for('home_bp.vulnerability_view', vulnerability_id=replaced)}}" class="card-link">{{replaced}}</a>
        </p>
        {%endfor%}
      {%endif%}
    {%else%}
      {% if vulnerability_data['containers']['cna']['title'] %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['title']}}</p>
      {% else %}
        <p class="card-text">{{vulnerability_data['containers']['cna']['descriptions'][0]['value']}}</p>
      {%endif%}
      {%if 'cisa_known_exploited' in vulnerability_data['meta']%}
        {{ cisa_known_exploited_view(vulnerability_data['meta']['cisa_known_exploited']) }}
      {%endif%}
    {%endif%}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro github_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/advisories" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['published'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['modified'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    {% if 'severity' in vulnerability_data and vulnerability_data['severity'] %}
    <div class="row">
      <div class="col-md-2 fw-bold">Severity</div>
      <div class="col">
        {% set severity_css = {"Low": "bg-success", "Medium": "bg-warning", "High": "bg-danger", "Critical": "bg-danger"} %}
        {% set versions = {"CVSS_V3": "3.1", "CVSS_V4": "4.0"} %}
        {% for severity in vulnerability_data['severity'] %}
          <span class="{{ severity_css[severity['score'] | cvss_severity(severity['type'])] }}">{{ severity['score'] | cvss_base_score(severity['type']) }} ({{ severity['score'] | cvss_severity(severity['type']) }})</span> - {{ severity['type'] }} - <a href="https://www.first.org/cvss/calculator/{{ versions[severity['type']] }}#{{ severity['score'] | cvss_clean_vector(severity['type']) }}" rel="noreferrer" target="_blank">{{ severity['score'] | cvss_clean_vector(severity['type']) }}</a><br />
        {% endfor %}
      </div>
    </div>
    {% endif %}
    {% if 'summary' in vulnerability_data  %}
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{ vulnerability_data['summary'] }}</div>
    </div>
    {% endif %}
    {% if 'details' in vulnerability_data  %}
    <div class="row">
      <div class="col-md-2 fw-bold">Details</div><div class="col">{{ vulnerability_data['details'] | markdown | safe }}</div>
    </div>
    {% endif %}
    <a href="https://github.com/advisories/{{vulnerability_id}}" class="card-link" rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro ossf_malicious_packages_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/ossf/malicious-packages" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{ vulnerability_data['summary'] }}</p>
    <p class="card-text">{{ vulnerability_data['details'] | markdown | safe }}</p>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_siemens_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.siemens.com/global/en/products/services/cert.html" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_certbund_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://wid.cert-bund.de/portal/wid/start" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_redhat_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://access.redhat.com/security/" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisa_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisa.gov" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_cisco_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.cisco.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_sick_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.sick.com/psirt"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_ox_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://open-xchange.com" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, ulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro csaf_nozominetworks_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://security.nozominetworks.com/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['document']['tracking']['initial_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['document']['tracking']['current_release_date'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Summary</div><div class="col">{{vulnerability_data['document']['title']}}</div>
    </div>
    {% if 'notes' in vulnerability_data['document'] %}<p class="card-text fw-bold">Notes</p>{% endif %}
    {% for note in vulnerability_data['document']['notes'] %}
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-2 fst-italic">{% if 'title' in note %}{{note['title']}}{% endif %}</div><div class="col">{{note['text']}}<hr /></div>
    </div>
    {% endfor %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro gsd_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://gsd.id" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['gsd']['osvSchema']['modified'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
      <div class="col-md-2 fw-bold">Details</div>
      {% if 'details' in vulnerability_data['gsd']['osvSchema'] %}
        <div class="col">{{ vulnerability_data['gsd']['osvSchema']['details'] }}</div>
      {% else  %}
        {% set namespaces = ['cisa.gov', 'cve.org', 'gitlab.com', 'nvd.nist.gov'] %}
        {% set languages = ['eng'] %}
        {% for namespace in namespaces %}
        {% if vulnerability_data['namespaces'].get(namespace, false)  %}
          {% if 'description' in vulnerability_data['namespaces'][namespace] %}
            {% for item in vulnerability_data['namespaces'][namespace]['description']['description_data'] %}
              {% if item['lang'] in languages %}
              <div class="col">{{ item['value'] }}</div>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endif %}
        {% endfor %}
      {% endif %}
    </div>
    {% if 'aliases' in vulnerability_data['gsd']['osvSchema'] %}
    <div class="row">
      <div class="col-md-2 fw-bold">Aliases</div>
      <div class="col">
        <ul class="list-group list-group-flush">
          {% for alias in vulnerability_data['gsd']['osvSchema']['aliases'] %}
          <li class="list-group-item"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=alias) }}">{{ alias }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro pysec_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://github.com/pypa/advisory-database" rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <div class="row">
      <div class="col-md-2 fw-bold">Published</div><div class="col">{{ vulnerability_data['published'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    <div class="row">
        <div class="col-md-2 fw-bold">Modified</div><div class="col">{{ vulnerability_data['modified'] | string_to_datetime('%Y-%m-%d %H:%M') }}</div>
    </div>
    {% if 'severity' in vulnerability_data and vulnerability_data['severity'] %}
    <div class="row">
      <div class="col-md-2 fw-bold">Severity</div>
      <div class="col">
        {% set severity_css = {"Low": "bg-success", "Medium": "bg-warning", "High": "bg-danger", "Critical": "bg-danger"} %}
        {% set versions = {"CVSS_V3": "3.1", "CVSS_V4": "4.0"} %}
        {% for severity in vulnerability_data['severity'] %}
          <span class="{{ severity_css[severity['score'] | cvss_severity(severity['type'])] }}">{{ severity['score'] | cvss_base_score(severity['type']) }} ({{ severity['score'] | cvss_severity(severity['type']) }})</span> - {{ severity['type'] }} - <a href="https://www.first.org/cvss/calculator/{{ versions[severity['type']] }}#{{ severity['score'] | cvss_clean_vector(severity['type']) }}" rel="noreferrer" target="_blank">{{ severity['score'] | cvss_clean_vector(severity['type']) }}</a><br />
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <div class="row">
        <div class="col-md-2 fw-bold">Details</div><div class="col">{{ vulnerability_data['details'] | markdown | safe }}</div>
    </div>
    {% if 'aliases' in vulnerability_data %}
    <div class="row">
      <div class="col-md-2 fw-bold">Aliases</div>
      <div class="col">
        <ul class="list-group list-group-flush">
          {% for alias in vulnerability_data['aliases'] %}
          <li class="list-group-item"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=alias) }}">{{ alias }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}

{% macro variot_view(source, vulnerability_id, vulnerability_data) -%}
  <div class="card">
  <div class="card-body">
    <h5 class="card-title"><a href="{{ url_for('home_bp.vulnerability_view', vulnerability_id=vulnerability_id) }}">{{vulnerability_id}}</a></h5>
    <h6 class="card-subtitle mb-2 text-body-secondary">
      Vulnerability from <a href="https://www.variotdbs.pl/vulns/"  rel="noreferrer" target="_blank">{{source}}</a>
    </h6>
    <p class="card-text">{{ vulnerability_data['description']['data'] | markdown | safe }}</p>
    <a href="https://www.variotdbs.pl/vuln/{{vulnerability_id}}" class="card-link"  rel="noreferrer" target="_blank">Show details on source website</a>
    {{ collapse_raw(source, vulnerability_id, vulnerability_data) }}
  </div>
</div>
{%- endmacro %}
